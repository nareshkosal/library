{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "workos",
  "type": "registry:block",
  "title": "WorkOS Authentication",
  "description": "Complete authentication block with WorkOS AuthKit including login, logout, and user context.",
  "dependencies": [
    "@workos-inc/authkit-nextjs"
  ],
  "registryDependencies": [
    "sidebar",
    "button",
    "dropdown-menu"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/workos/components/header.tsx",
      "content": "// @ts-nocheck\nimport Link from 'next/link'\nimport { withAuth, getSignInUrl, signOut } from '@workos-inc/authkit-nextjs'\n\nexport default async function Header() {\n  const { user } = await withAuth()\n  const signInUrl = await getSignInUrl()\n\n  return (\n    <header className=\"flex items-center justify-between py-4 px-4 border-b\">\n      <div className=\"flex items-center gap-4\">\n        <Link href=\"/\" className=\"font-semibold\">Registry</Link>\n        <nav className=\"hidden sm:flex items-center gap-3\">\n          <Link href=\"/\" className=\"text-sm text-muted-foreground hover:text-foreground\">Home</Link>\n          <Link href=\"/settings\" className=\"text-sm text-muted-foreground hover:text-foreground\">Settings</Link>\n        </nav>\n      </div>\n      {user ? (\n        <form\n          action={async () => {\n            'use server'\n            await signOut()\n          }}\n        >\n          <button type=\"submit\" className=\"text-sm underline\">Sign out</button>\n        </form>\n      ) : (\n        <Link href={signInUrl} className=\"text-sm underline\">Sign in</Link>\n      )}\n    </header>\n  )\n}",
      "type": "registry:component",
      "target": "components/header.tsx"
    },
    {
      "path": "registry/new-york/blocks/workos/components/sidebar.tsx",
      "content": "'use client'\n\nimport * as React from \"react\"\nimport { Home, Settings, User, Menu, LogOut } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/registry/new-york/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/registry/new-york/ui/dropdown-menu\"\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarProvider,\n  SidebarTrigger,\n  SidebarRail,\n} from \"@/registry/new-york/ui/sidebar\"\n\n// Navigation data\nconst navItems = [\n  {\n    title: \"Dashboard\",\n    icon: Home,\n    href: \"/\",\n  },\n  {\n    title: \"Profile\",\n    icon: User,\n    href: \"/profile\",\n  },\n  {\n    title: \"Settings\",\n    icon: Settings,\n    href: \"/settings\",\n  },\n]\n\ninterface WorkOSSidebarProps {\n  className?: string\n  children: React.ReactNode\n  user?: {\n    email: string\n    name?: string\n    avatarUrl?: string\n  } | null\n  onSignOut?: () => Promise<void>\n}\n\nexport function WorkOSSidebar({\n  className,\n  children,\n  user,\n  onSignOut,\n  ...props\n}: WorkOSSidebarProps) {\n  return (\n    <SidebarProvider>\n      <div className={cn(\"flex h-screen w-full\", className)} {...props}>\n        <Sidebar>\n          <SidebarHeader>\n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton size=\"lg\">\n                  <div className=\"flex aspect-square size-8 items-center justify-center rounded-lg bg-black text-white\">\n                    <Menu className=\"size-4\" />\n                  </div>\n                  <div className=\"grid flex-1 text-left text-sm leading-tight\">\n                    <span className=\"truncate font-semibold\">WorkOS App</span>\n                  </div>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </SidebarHeader>\n          \n          <SidebarContent>\n            <SidebarGroup>\n              <SidebarGroupLabel>Navigation</SidebarGroupLabel>\n              <SidebarMenu>\n                {navItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton asChild>\n                      <a href={item.href}>\n                        <item.icon className=\"mr-2 size-4\" />\n                        <span>{item.title}</span>\n                      </a>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroup>\n          </SidebarContent>\n          \n          <SidebarFooter>\n            <SidebarMenu>\n              {user ? (\n                <>\n                  <SidebarMenuItem>\n                    <SidebarMenuButton>\n                      <div className=\"flex aspect-square size-8 items-center justify-center rounded-full bg-gray-200\">\n                        <User className=\"size-4\" />\n                      </div>\n                      <span>{user.name || user.email}</span>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                  {onSignOut && (\n                    <SidebarMenuItem>\n                      <SidebarMenuButton asChild>\n                        <button \n                          onClick={onSignOut}\n                          className=\"flex w-full items-center text-left\"\n                        >\n                          <LogOut className=\"mr-2 size-4\" />\n                          <span>Logout</span>\n                        </button>\n                      </SidebarMenuButton>\n                    </SidebarMenuItem>\n                  )}\n                </>\n              ) : (\n                <SidebarMenuItem>\n                  <SidebarMenuButton asChild>\n                    <a href=\"/login\">\n                      <User className=\"mr-2 size-4\" />\n                      <span>Sign In</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              )}\n            </SidebarMenu>\n          </SidebarFooter>\n          \n          <SidebarRail />\n        </Sidebar>\n        \n        <div className=\"flex flex-1 flex-col\">\n          <header className=\"flex h-14 items-center justify-between border-b bg-background px-4\">\n            <div className=\"flex items-center gap-2\">\n              <SidebarTrigger />\n              <h1 className=\"ml-4 text-lg font-semibold\">WorkOS Dashboard</h1>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              {user && (\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\">\n                      {user.name || user.email}\n                      <span className=\"ml-1\">▼</span>\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem>\n                      <a href=\"/profile\">Profile</a>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem>\n                      <a href=\"/settings\">Settings</a>\n                    </DropdownMenuItem>\n                    {onSignOut && (\n                      <DropdownMenuItem>\n                        <button \n                          onClick={onSignOut}\n                          className=\"w-full text-left\"\n                        >\n                          Logout\n                        </button>\n                      </DropdownMenuItem>\n                    )}\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              )}\n            </div>\n          </header>\n          <main className=\"flex flex-1 flex-col gap-4 p-0 lg:gap-0\">\n            {children}\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  )\n}",
      "type": "registry:component",
      "target": "components/sidebar.tsx"
    },
    {
      "path": "registry/new-york/blocks/workos/sidebar-layout.tsx",
      "content": "'use client'\n\nimport * as React from \"react\"\nimport { Home, Settings, User, Menu, LogOut } from \"lucide-react\"\nimport { useRouter } from 'next/navigation'\nimport type { WorkOSUser } from \"./types/workos-user\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/registry/new-york/ui/button\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/registry/new-york/ui/dropdown-menu\"\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarProvider,\n  SidebarTrigger,\n  SidebarRail,\n} from \"@/registry/new-york/ui/sidebar\"\n\n// Navigation data\nconst navItems = [\n  {\n    title: \"Dashboard\",\n    icon: Home,\n    href: \"/\",\n  },\n  {\n    title: \"Profile\",\n    icon: User,\n    href: \"/profile\",\n  },\n  {\n    title: \"Settings\",\n    icon: Settings,\n    href: \"/settings\",\n  },\n]\n\ninterface WorkOSSidebarLayoutProps {\n  children: React.ReactNode\n  user?: WorkOSUser | null\n  className?: string\n}\n\nexport function WorkOSSidebarLayout({ children, user, className }: WorkOSSidebarLayoutProps) {\n  const router = useRouter()\n  const userName = user?.firstName && user?.lastName \n    ? `${user.firstName} ${user.lastName}` \n    : user?.email || 'User'\n\n  const handleSignOut = async () => {\n    try {\n      const response = await fetch('/logout', { method: 'POST' })\n      if (response.ok) {\n        router.refresh()\n        router.push('/')\n      }\n    } catch (error) {\n      console.error('Sign out error:', error)\n    }\n  }\n\n  return (\n    <SidebarProvider>\n      <div className={cn(\"flex h-screen w-full\", className)}>\n        <Sidebar>\n          <SidebarHeader>\n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton size=\"lg\">\n                  <div className=\"flex aspect-square size-8 items-center justify-center rounded-lg bg-black text-white\">\n                    <Menu className=\"size-4\" />\n                  </div>\n                  <div className=\"grid flex-1 text-left text-sm leading-tight\">\n                    <span className=\"truncate font-semibold\">WorkOS App</span>\n                  </div>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </SidebarHeader>\n          \n          <SidebarContent>\n            <SidebarGroup>\n              <SidebarGroupLabel>Navigation</SidebarGroupLabel>\n              <SidebarMenu>\n                {navItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton asChild>\n                      <a href={item.href}>\n                        <item.icon className=\"mr-2 size-4\" />\n                        <span>{item.title}</span>\n                      </a>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroup>\n          </SidebarContent>\n          \n          <SidebarFooter>\n            <SidebarMenu>\n              {user ? (\n                <>\n                  <SidebarMenuItem>\n                    <SidebarMenuButton>\n                      {user.profilePictureUrl ? (\n                        <img \n                          src={user.profilePictureUrl} \n                          alt={userName}\n                          className=\"aspect-square size-8 rounded-full object-cover\"\n                        />\n                      ) : (\n                        <div className=\"flex aspect-square size-8 items-center justify-center rounded-full bg-gray-200\">\n                          <User className=\"size-4\" />\n                        </div>\n                      )}\n                      <span>{userName}</span>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                  <SidebarMenuItem>\n                    <SidebarMenuButton asChild>\n                      <button \n                        onClick={handleSignOut}\n                        className=\"flex w-full items-center text-left\"\n                      >\n                        <LogOut className=\"mr-2 size-4\" />\n                        <span>Logout</span>\n                      </button>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                </>\n              ) : (\n                <SidebarMenuItem>\n                  <SidebarMenuButton asChild>\n                    <a href=\"/login\">\n                      <User className=\"mr-2 size-4\" />\n                      <span>Sign In</span>\n                    </a>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              )}\n            </SidebarMenu>\n          </SidebarFooter>\n          \n          <SidebarRail />\n        </Sidebar>\n        \n        <div className=\"flex flex-1 flex-col\">\n          <header className=\"flex h-14 items-center justify-between border-b bg-background px-4\">\n            <div className=\"flex items-center gap-2\">\n              <SidebarTrigger />\n              <h1 className=\"ml-4 text-lg font-semibold\">WorkOS Dashboard</h1>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              {user && (\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                      {user.profilePictureUrl ? (\n                        <img \n                          src={user.profilePictureUrl} \n                          alt={userName}\n                          className=\"aspect-square size-4 rounded-full object-cover\"\n                        />\n                      ) : (\n                        <User className=\"size-4\" />\n                      )}\n                      {userName}\n                      <span className=\"ml-1\">▼</span>\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem>\n                      <a href=\"/profile\">Profile</a>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem>\n                      <a href=\"/settings\">Settings</a>\n                    </DropdownMenuItem>\n                    <DropdownMenuItem>\n                      <button \n                        onClick={handleSignOut}\n                        className=\"w-full text-left\"\n                      >\n                        Logout\n                      </button>\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              )}\n            </div>\n          </header>\n          <main className=\"flex flex-1 flex-col gap-4 p-0 lg:gap-0\">\n            {children}\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  )\n}",
      "type": "registry:component",
      "target": "components/workos-sidebar-layout.tsx"
    },
    {
      "path": "registry/new-york/blocks/workos/types/user.ts",
      "content": "// WorkOS User type definition\nexport interface WorkOSUser {\n  object: string\n  id: string\n  email: string\n  emailVerified: boolean\n  firstName: string | null\n  profilePictureUrl: string | null\n  lastName: string | null\n  lastSignInAt: string | null // ISO timestamp\n  locale: string | null\n  createdAt: string | null // ISO timestamp\n  updatedAt: string | null // ISO timestamp\n  externalId: string | null\n  metadata: Record<string, any>\n}",
      "type": "registry:component",
      "target": "types/workos-user.ts"
    },
    {
      "path": "registry/new-york/blocks/workos/app-layout-complete.tsx",
      "content": "// This is a complete app/layout.tsx file with WorkOS integration\n// It can be used to automatically replace the existing layout during installation\n\nimport type { Metadata } from \"next\"\nimport { Geist, Geist_Mono } from \"next/font/google\"\nimport \"./globals.css\"\nimport { withAuth } from \"@workos-inc/authkit-nextjs\"\nimport type { WorkOSUser } from \"@/types/workos-user\"\nimport { WorkOSSidebarLayout } from \"@/components/workos-sidebar-layout\"\n\nconst geistSans = Geist({\n  variable: \"--font-geist-sans\",\n  subsets: [\"latin\"],\n})\n\nconst geistMono = Geist_Mono({\n  variable: \"--font-geist-mono\",\n  subsets: [\"latin\"],\n})\n\nexport const metadata: Metadata = {\n  title: \"WorkOS App\",\n  description: \"Application with WorkOS authentication\",\n}\n\nexport default async function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  let user: WorkOSUser | null = null\n  try {\n    const { user: authUser } = await withAuth()\n    user = (authUser as WorkOSUser) || null\n  } catch (_) {}\n  return (\n    <html lang=\"en\">\n      <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>\n        <WorkOSSidebarLayout user={user}>\n          {children}\n        </WorkOSSidebarLayout>\n      </body>\n    </html>\n  )\n}",
      "type": "registry:component",
      "target": "app/layout.tsx"
    },
    {
      "path": "registry/new-york/blocks/workos/app/api/auth/status/route.ts",
      "content": "import { NextResponse } from 'next/server'\nimport { withAuth } from '@workos-inc/authkit-nextjs'\n\nexport async function GET() {\n  try {\n    const { user } = await withAuth()\n    \n    return NextResponse.json({ \n      user,\n      authenticated: !!user \n    })\n  } catch (error) {\n    // User is not authenticated\n    return NextResponse.json({ \n      user: null,\n      authenticated: false \n    }, { status: 401 })\n  }\n}",
      "type": "registry:component",
      "target": "app/api/auth/status/route.ts"
    },
    {
      "path": "registry/new-york/blocks/workos/README.md",
      "content": "# WorkOS Block Installation Guide\n\nThis WorkOS block provides two approaches for integration:\n\n## Approach 1: Server-Side (Default)\nUses `app/layout.tsx` with server-side authentication\n\n**Pros:**\n- Better performance (no client-side auth check)\n- SEO-friendly\n- Cleaner code\n\n**Requirements:**\n- Middleware must be properly configured\n- All routes must be covered by middleware\n\n## Approach 2: Client-Side (Fallback)\nUses `app/layout-client.tsx` with client-side authentication\n\n**Pros:**\n- No middleware configuration needed\n- More flexible routing\n- Easier to debug\n\n**Cons:**\n- Slight loading delay on auth check\n- Client-side JavaScript required\n\n## Fixing the Middleware Error\n\nIf you get the error: \"You are calling 'withAuth' on a route that isn't covered by the AuthKit middleware\"\n\n### Option 1: Fix Middleware Configuration\nEnsure your `middleware.ts` covers all necessary routes:\n\n```typescript\nexport const config = {\n  matcher: [\n    '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n}\n```\n\n### Option 2: Use Client-Side Approach\nReplace your `app/layout.tsx` with the client-side version:\n\n```bash\nmv app/layout-client.tsx app/layout.tsx\n```\n\nThe client-side version uses `/api/auth/status` endpoint instead of `withAuth()` and doesn't require middleware configuration.",
      "type": "registry:component",
      "target": "WORKOS_INSTALLATION.md"
    },
    {
      "path": "registry/new-york/blocks/workos/contexts/UserContext.tsx",
      "content": "import React, { createContext, useContext, ReactNode } from \"react\"\nimport type { WorkOSUser } from \"../types/workos-user\"\n\ninterface UserContextType {\n  user: WorkOSUser | null\n}\n\nconst UserContext = createContext<UserContextType | undefined>(undefined)\n\ninterface UserProviderProps {\n  children: ReactNode\n  user: WorkOSUser | null\n}\n\nexport function UserProvider({ children, user }: UserProviderProps) {\n  return <UserContext.Provider value={{ user }}>{children}</UserContext.Provider>\n}\n\nexport function useUser() {\n  const context = useContext(UserContext)\n  if (context === undefined) {\n    throw new Error(\"useUser must be used within a UserProvider\")\n  }\n  return context\n}",
      "type": "registry:component",
      "target": "contexts/UserContext.tsx"
    },
    {
      "path": "registry/new-york/blocks/workos/middleware.ts",
      "content": "// @ts-nocheck\nimport { authkitMiddleware } from '@workos-inc/authkit-nextjs'\n\n// Full middleware solution; protects routes and manages the session.\nexport default authkitMiddleware()\n\n// Configure which routes should be matched by middleware-based auth.\n// This covers all routes except API routes and static files\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n}",
      "type": "registry:component",
      "target": "middleware.ts"
    },
    {
      "path": "registry/new-york/blocks/workos/app/login/route.ts",
      "content": "// @ts-nocheck\nimport { getSignInUrl } from '@workos-inc/authkit-nextjs'\n\n// Login endpoint — redirects users into AuthKit’s hosted flow.\nexport const GET = async () => {\n  const url = await getSignInUrl()\n  return Response.redirect(url)\n}",
      "type": "registry:component",
      "target": "app/login/route.ts"
    },
    {
      "path": "registry/new-york/blocks/workos/app/callback/route.ts",
      "content": "// @ts-nocheck\nimport { handleAuth } from '@workos-inc/authkit-nextjs'\n\n// AuthKit callback endpoint — matches WORKOS redirect URI.\nexport const GET = handleAuth()",
      "type": "registry:component",
      "target": "app/callback/route.ts"
    },
    {
      "path": "registry/new-york/blocks/workos/app/logout/route.ts",
      "content": "// @ts-nocheck\nimport { signOut } from '@workos-inc/authkit-nextjs'\n\n// Signs out the current user and redirects to the configured Logout URI\nexport const GET = async () => {\n  return await signOut()\n}",
      "type": "registry:component",
      "target": "app/logout/route.ts"
    }
  ]
}